<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lingmatch">
<title>Introduction to Text Classification • lingmatch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to Text Classification">
<meta property="og:description" content="lingmatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lingmatch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../articles/quickstart.html">Quick Start</a>
    <a class="dropdown-item" href="../articles/groups.html">Group Comparisons</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Introductions</h6>
    <a class="dropdown-item" href="../articles/introduction.html">Text Analysis</a>
    <a class="dropdown-item" href="../articles/word_vectors.html">Word Vectors</a>
    <a class="dropdown-item" href="../articles/text_classification.html">Text Classification</a>
    <a class="dropdown-item" href="../articles/dictionary_creation.html">Dictionary Creation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/miserman/lingmatch/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to Text Classification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/miserman/lingmatch/blob/HEAD/vignettes/text_classification.Rmd" class="external-link"><code>vignettes/text_classification.Rmd</code></a></small>
      <div class="d-none name"><code>text_classification.Rmd</code></div>
    </div>

    
    
<p>Works through a text classification example.</p>
<p><em>Built with R 4.3.1 on October 07 2023</em></p>
<hr>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>First, we need to load in some text. We will be using supervised
classification methods, which require text to be labeled in some way.
Labels can range from manual codings (human classifications you’re
trying to replicate) to contextual features such as source.</p>
<p>For this example, we have free-response text from a study in which
participants were asked to recall a time when they behaved in either a
feminine or masculine manner (<a href="https://osf.io/ra8zy/wiki/home" class="external-link">osf.io/ra8zy</a>). With these
examples, we can train a classifier to predict whether a text is
describing feminine or masculine behavior.</p>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download and load the data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://osf.io/download/vyste"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove duplicate and empty texts</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">phase</span> <span class="op">==</span> <span class="st">"Pre"</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">Recall_Text</span> <span class="op">!=</span> <span class="st">""</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-a-train-test-split">Make a train-test split<a class="anchor" aria-label="anchor" href="#make-a-train-test-split"></a>
</h3>
<p>The ultimate goal of our classifier may be to automatically label new
text in the future. How well the classifier is able to do this depends
in part on how similar those texts are to the training texts. The best
case is that the new texts conceptually come from the same population of
texts as our training sample. In that case, testing on a held-out
portion of our sample can make for a guess at the classifier’s future
performance.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at the class base-rates (by design, they are roughly even)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Feminine Masculine </span></span>
<span><span class="co">#&gt;  0.495283  0.504717</span></span>
<span></span>
<span><span class="co"># define a train sample by drawing 70% of each class</span></span>
<span><span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">classes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">class_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall</span> <span class="op">==</span> <span class="va">class</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">class_ids</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">class_ids</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.7</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span>, use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now you have two datasets with similar class distributions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">train_ids</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">train_ids</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"train"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       Feminine Masculine total</span></span>
<span><span class="co">#&gt; test        32        33    65</span></span>
<span><span class="co">#&gt; train       73        74   147</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="process-texts">Process texts<a class="anchor" aria-label="anchor" href="#process-texts"></a>
</h2>
<p>Processing text is the process of deriving features from it. One of
the most straightforward ways to do this is extracting and counting
single words (unigrams), which results in a document-term matrix.</p>
<p>Words vary in meaning and quality as cues, so there are two common
exclusion heuristics to help address this: Stop word removal excludes
function words, which are high-frequency but often less meaningful
words, and a document-count minimum excludes words that are sufficiently
rare in the given set.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/miserman/lingmatch" class="external-link">lingmatch</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lma_dict() in the second position excludes function words</span></span>
<span><span class="co"># dc.min excludes terms with document-frequencies less than or equal to the set value</span></span>
<span><span class="va">dtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_dtm.html">lma_dtm</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall_Text</span>, <span class="fu"><a href="../reference/lma_dict.html">lma_dict</a></span><span class="op">(</span><span class="op">)</span>, dc.min <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract the test rows</span></span>
<span><span class="co"># splitting after creating a dtm ensures features are consistent between splits,</span></span>
<span><span class="co"># but be cognizant of information passing between splits (such as if you were to</span></span>
<span><span class="co"># document weight before splitting)</span></span>
<span><span class="va">test_dtm</span> <span class="op">&lt;-</span> <span class="va">dtm</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span>, <span class="op">]</span></span>
<span><span class="va">dtm</span> <span class="op">&lt;-</span> <span class="va">dtm</span><span class="op">[</span><span class="va">train_ids</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="train-a-classifier">Train a classifier<a class="anchor" aria-label="anchor" href="#train-a-classifier"></a>
</h2>
<p>Training a classifier in this case generally involves learning
class-associated weights for terms, with “learning” potentially being as
simple as calculating differences.</p>
<div class="section level3">
<h3 id="term-based-classifier">Term-based classifier<a class="anchor" aria-label="anchor" href="#term-based-classifier"></a>
</h3>
<p>A basic classifier could use difference in document counts (binary
frequencies) between classes to associate terms with each class. What
results from this training is a dictionary with a category for each
class, containing class-related terms.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate differences in binary document counts (probabilities) between classes</span></span>
<span><span class="va">feminine_texts</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Feminine"</span></span>
<span><span class="va">term_diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">[</span><span class="va">feminine_texts</span>, <span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">[</span><span class="op">!</span><span class="va">feminine_texts</span>, <span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a dictionary from the 40 most differing terms for each class</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Feminine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">term_diffs</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>,</span>
<span>  Masculine <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">term_diffs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The dictionary contains the learned word-associations which will be
used later to classify texts. We can inspect these for a sense of which
terms are most important.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># words sized by frequency, colored by associated gender,</span></span>
<span><span class="co"># and shaded by absolute difference</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://blog.fellstat.com/?cat=11" class="external-link">wordcloud</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://miserman.github.io/splot/" class="external-link">splot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">names</span><span class="op">)</span>, use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html" class="external-link">wordcloud</a></span><span class="op">(</span></span>
<span>  <span class="va">terms</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">[</span>, <span class="va">terms</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  min.freq <span class="op">=</span> <span class="fl">0</span>, random.order <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  random.color <span class="op">=</span> <span class="cn">FALSE</span>, rot.per <span class="op">=</span> <span class="fl">0</span>, ordered.colors <span class="op">=</span> <span class="cn">TRUE</span>, fixed.asp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  colors <span class="op">=</span> <span class="fu"><a href="https://miserman.github.io/splot/reference/splot.color.html" class="external-link">splot.color</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">term_diffs</span><span class="op">[</span><span class="va">terms</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">length</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span>, text.col <span class="op">=</span> <span class="fu"><a href="https://miserman.github.io/splot/reference/splot.color.html" class="external-link">splot.color</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  text.font <span class="op">=</span> <span class="fl">2</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="text_classification_files/figure-html/unnamed-chunk-6-1.svg" width="864"></p>
</div>
<div class="section level3">
<h3 id="naïve-bayes-classifier">Naïve Bayes classifier<a class="anchor" aria-label="anchor" href="#na%C3%AFve-bayes-classifier"></a>
</h3>
<p>The Bernoulli Naïve Bayes classifier uses the same information, but
will often smooth the probabilities.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/majkamichal/naivebayes" class="external-link">naivebayes</a></span><span class="op">)</span></span>
<span><span class="va">weights_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://majkamichal.github.io/naivebayes/reference/bernoulli_naive_bayes.html" class="external-link">bernoulli_naive_bayes</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">dtm</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span>, <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span>,</span>
<span>  laplace <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># what's returned is just the smoothed, conditional probability of each term</span></span>
<span><span class="va">laplace</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  manual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">[</span>, <span class="st">"dress"</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">laplace</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">laplace</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  package <span class="op">=</span> <span class="va">weights_nb</span><span class="op">$</span><span class="va">prob1</span><span class="op">[</span><span class="st">"dress"</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;          Feminine  Masculine</span></span>
<span><span class="co">#&gt; manual  0.1733333 0.05263158</span></span>
<span><span class="co">#&gt; package 0.1733333 0.05263158</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="decision-tree-classifier">Decision Tree classifier<a class="anchor" aria-label="anchor" href="#decision-tree-classifier"></a>
</h3>
<p>Decision trees (learned by a recursive partitioning algorithm) are
similar to the previous methods, but consider conditional differences in
terms.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html" class="external-link">rpart.plot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">weight_dtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># default settings often select very few features,</span></span>
<span><span class="co"># making these models particularly interpretable</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html" class="external-link">rpart.plot</a></span><span class="op">(</span></span>
<span>  <span class="va">weight_dtree</span>,</span>
<span>  extra <span class="op">=</span> <span class="fl">2</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  branch.col <span class="op">=</span> <span class="st">"white"</span>, split.box.col <span class="op">=</span> <span class="st">"black"</span>, split.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  nn.box.col <span class="op">=</span> <span class="st">"black"</span>, nn.col <span class="op">=</span> <span class="st">"white"</span>, space <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="text_classification_files/figure-html/unnamed-chunk-8-1.svg" width="864"></p>
</div>
<div class="section level3">
<h3 id="support-vector-machine-classifier">Support Vector Machine classifier<a class="anchor" aria-label="anchor" href="#support-vector-machine-classifier"></a>
</h3>
<p>There are many many other types of classifiers, many of which are
based on essentially the same information, but have the potential to
pick up on different features.</p>
<p>You can easily apply a range of other classifiers with the
<code>caret</code> package (see <a href="https://topepo.github.io/caret" class="external-link">topepo.github.io/caret</a>), which
also adds some parameter tuning.</p>
<p>Many models also have regularizing versions available (that
effectively select features), which is particularly useful when there
are many features, as is often the case with text.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="va">weights_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span>, <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span>, <span class="st">"svmLinear3"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="neural-network-classifiers">Neural Network classifiers<a class="anchor" aria-label="anchor" href="#neural-network-classifiers"></a>
</h3>
<p>Neural Networks are particularly flexible in terms of input, so they
offer a way to use sequence information (getting away from a
bag-of-words approach).</p>
<p><code>Keras</code> is a framework for setting up neural models. The
package is an interface to Python, so some additional setup may be
required on your system, though it should be handled automatically (see
<a href="https://keras.rstudio.com" class="external-link">keras.rstudio.com</a>).</p>
<div class="section level4">
<h4 id="basic-model">Basic model<a class="anchor" aria-label="anchor" href="#basic-model"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># process texts in the same way, but add tokens.only = TRUE to preserve sequence</span></span>
<span><span class="co"># information</span></span>
<span><span class="va">tokenized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_dtm.html">lma_dtm</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall_Text</span>, <span class="fu"><a href="../reference/lma_dict.html">lma_dict</a></span><span class="op">(</span><span class="op">)</span>, dc.min <span class="op">=</span> <span class="fl">5</span>, tokens.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify your layers</span></span>
<span><span class="va">weights_neural</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># this set of layers translates input sequences of word indices to</span></span>
<span>  <span class="co"># small embeddings, which are learned on the fly,</span></span>
<span>  <span class="co"># then averages over the set of embeddings for a single text-centroid vector</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_embedding.html" class="external-link">layer_embedding</a></span><span class="op">(</span>input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">tokens</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, output_dim <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_global_average_pooling_1d.html" class="external-link">layer_global_average_pooling_1d</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># these are more or less arbitrary layers that can be played with more freely</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">16</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dropout.html" class="external-link">layer_dropout</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># this is the final prediction layer, which converts the previous arbitrary layers</span></span>
<span>  <span class="co"># to a binary classification</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then compile the model (this changes the weights_neural object)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  <span class="va">weights_neural</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"adam"</span>, metrics <span class="op">=</span> <span class="st">"accuracy"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and train the model on the training sample</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>  <span class="va">weights_neural</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/pad_sequences.html" class="external-link">pad_sequences</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">indices</span><span class="op">[</span><span class="va">train_ids</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">WC</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">feminine_texts</span><span class="op">)</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">40</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pre-trained-embeddings-model">Pre-trained embeddings model<a class="anchor" aria-label="anchor" href="#pre-trained-embeddings-model"></a>
</h4>
<p>We can also use pre-trained embeddings, and instead of simply
averaging over all words, we can first use a convolution layer to
calculated weighted sums over word windows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load a set of pre-trained embeddings, with unrecognized terms added with</span></span>
<span><span class="co"># weights of 0</span></span>
<span><span class="va">space</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_lspace.html">lma_lspace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">tokens</span><span class="op">)</span>, <span class="st">"glove"</span>, fill.missing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights_neural_glove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># this layer contains the loaded embeddings, which will not be adjusted</span></span>
<span>  <span class="co"># during training</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_embedding.html" class="external-link">layer_embedding</a></span><span class="op">(</span></span>
<span>    input_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">space</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, output_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">space</span><span class="op">)</span>,</span>
<span>    input_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">WC</span><span class="op">)</span>, trainable <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">space</span><span class="op">)</span><span class="op">)</span>, <span class="va">space</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># this layer convolves (calculates weighted sums) over the</span></span>
<span>  <span class="co"># embeddings vectors within a window (set by kernel_size)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_conv_1d.html" class="external-link">layer_conv_1d</a></span><span class="op">(</span>filters <span class="op">=</span> <span class="fl">16</span>, kernel_size <span class="op">=</span> <span class="fl">5</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># same final layers as the initial model</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_global_average_pooling_1d.html" class="external-link">layer_global_average_pooling_1d</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">16</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dropout.html" class="external-link">layer_dropout</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  <span class="va">weights_neural_glove</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"adam"</span>, metrics <span class="op">=</span> <span class="st">"accuracy"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>  <span class="va">weights_neural_glove</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/pad_sequences.html" class="external-link">pad_sequences</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">indices</span><span class="op">[</span><span class="va">train_ids</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">WC</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">feminine_texts</span><span class="op">)</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">40</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="apply-and-assess-classifiers">Apply and Assess classifiers<a class="anchor" aria-label="anchor" href="#apply-and-assess-classifiers"></a>
</h2>
<p>Now, we can feed the previously trained weights into their
classifiers (or calculate predictions manually), then measure accuracy
(percent of real test labels guessed correctly).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare the testset index sequences for the neural predictions</span></span>
<span><span class="va">test_sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/pad_sequences.html" class="external-link">pad_sequences</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">indices</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tokenized</span><span class="op">$</span><span class="va">WC</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get predicted labels from each model</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  terms <span class="op">=</span> <span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col</a></span><span class="op">(</span><span class="fu"><a href="../reference/lma_termcat.html">lma_termcat</a></span><span class="op">(</span><span class="va">test_dtm</span>, <span class="va">dict</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bayes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">weights_nb</span>, <span class="op">(</span><span class="va">test_dtm</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  dtree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">weight_dtree</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_dtm</span><span class="op">)</span><span class="op">)</span>, <span class="st">"class"</span><span class="op">)</span>,</span>
<span>  svm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">weights_svm</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_dtm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  neural <span class="op">=</span> <span class="va">classes</span><span class="op">[</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">weights_neural</span>, <span class="va">test_sequences</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">]</span>,</span>
<span>  neural_glove <span class="op">=</span> <span class="va">classes</span><span class="op">[</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">weights_neural_glove</span>, <span class="va">test_sequences</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># when you have multiple classifiers, you can also add an ensemble classifier based</span></span>
<span><span class="co"># on them by, for example, taking the most-predicted class</span></span>
<span><span class="va">predictions</span><span class="op">$</span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="va">classes</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">predictions</span> <span class="op">==</span> <span class="va">classes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># overall accuracies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">predictions</span> <span class="op">==</span> <span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               accuracy</span></span>
<span><span class="co">#&gt; terms        0.7076923</span></span>
<span><span class="co">#&gt; bayes        0.7692308</span></span>
<span><span class="co">#&gt; dtree        0.7846154</span></span>
<span><span class="co">#&gt; svm          0.8153846</span></span>
<span><span class="co">#&gt; neural       0.7692308</span></span>
<span><span class="co">#&gt; neural_glove 0.8000000</span></span>
<span><span class="co">#&gt; ensemble     0.8615385</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="testing-decisions">Testing decisions<a class="anchor" aria-label="anchor" href="#testing-decisions"></a>
</h2>
<p>The examples so far have taken a simple, default approach to
processing texts, but often there is little reason behind each
processing decisions. In such cases, parameters can be selected
empirically by trying each option and measuring accuracy of the model
within sample.</p>
<div class="section level3">
<h3 id="weight-schemes">Weight schemes<a class="anchor" aria-label="anchor" href="#weight-schemes"></a>
</h3>
<p>For example, we might see if keeping or excluding stop words is best
with different weighting schemes in the term-based model:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list every combination of term and document weights</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pmi"</span>, <span class="st">"ppmi"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binary"</span>, <span class="st">"log"</span>, <span class="st">"sqrt"</span>, <span class="st">"count"</span>, <span class="st">"amplify"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dflog"</span>, <span class="st">"entropy"</span>, <span class="st">"ppois"</span>, <span class="st">"dpois"</span>, <span class="st">"dfmlog"</span>, <span class="st">"dfmax"</span>, <span class="st">"df"</span>, <span class="st">"idf"</span>,</span>
<span>    <span class="st">"ridf"</span>, <span class="st">"normal"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">paste</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"-"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set up an empty matrix for results</span></span>
<span><span class="va">weight_accuracies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">weights</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"keep"</span>, <span class="st">"exclude"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop through each stop word option</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">exclude</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># reprocess texts with or without stop words removed</span></span>
<span>  <span class="va">tdtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_dtm.html">lma_dtm</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall_Text"</span><span class="op">]</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">exclude</span><span class="op">)</span> <span class="fu"><a href="../reference/lma_dict.html">lma_dict</a></span><span class="op">(</span><span class="op">)</span> <span class="kw">else</span> <span class="cn">NULL</span>,</span>
<span>    dc.min <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># loop through each weighting scheme</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">weight</span> <span class="kw">in</span> <span class="va">weights</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># apply the weighting scheme</span></span>
<span>    <span class="va">wdtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_weight.html">lma_weight</a></span><span class="op">(</span><span class="va">tdtm</span>, <span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># calculate mean differences between classes for each term</span></span>
<span>    <span class="va">wterm_diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">wdtm</span><span class="op">[</span><span class="va">feminine_texts</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">wdtm</span><span class="op">[</span><span class="op">!</span><span class="va">feminine_texts</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># make dictionaries from the top 40 terms in each class</span></span>
<span>    <span class="co"># then calculate category scores (applying the same weight</span></span>
<span>    <span class="co"># scheme and taking the biggest as the class prediction)</span></span>
<span>    <span class="va">wterm_preds</span> <span class="op">&lt;-</span> <span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col</a></span><span class="op">(</span><span class="fu"><a href="../reference/lma_termcat.html">lma_termcat</a></span><span class="op">(</span><span class="va">wdtm</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Feminine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">wterm_diffs</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>,</span>
<span>      Masculine <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">wterm_diffs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># add the resulting accuracy to the set of results</span></span>
<span>    <span class="va">weight_accuracies</span><span class="op">[</span><span class="va">weight</span>, <span class="va">exclude</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">wterm_preds</span> <span class="op">==</span> <span class="va">data</span><span class="op">[</span><span class="va">train_ids</span>, <span class="st">"Recall"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># note that dark = TRUE makes the text white, so you might need to remove it</span></span>
<span><span class="fu"><a href="https://miserman.github.io/splot/reference/splot.html" class="external-link">splot</a></span><span class="op">(</span></span>
<span>  <span class="va">weight_accuracies</span> <span class="op">~</span> <span class="va">weights</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"point"</span>, title <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  leg.title <span class="op">=</span> <span class="st">"Stop words"</span>, laby <span class="op">=</span> <span class="st">"Overall Accuracy"</span>, labx <span class="op">=</span> <span class="st">"Weight Scheme"</span>,</span>
<span>  lpos <span class="op">=</span> <span class="st">"bottomleft"</span>, note <span class="op">=</span> <span class="cn">FALSE</span>, sort <span class="op">=</span> <span class="cn">TRUE</span>, mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.7</span>, <span class="fl">.5</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, dark <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="text_classification_files/figure-html/unnamed-chunk-13-1.svg" width="864"></p>
</div>
<div class="section level3">
<h3 id="train-test-splits">Train-test splits<a class="anchor" aria-label="anchor" href="#train-test-splits"></a>
</h3>
<p>A more general consideration when using random train-test splits is
that results will probably vary a bit between resplits, so close results
may not be reliably different.</p>
<p>For example, we might compare the performance of the simpler models.
Depending on the data and model, this can be slow, so we’ll also
parallelize it:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a full dtm</span></span>
<span><span class="va">full_dtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lma_dtm.html">lma_dtm</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall_Text</span>, <span class="fu"><a href="../reference/lma_dict.html">lma_dict</a></span><span class="op">(</span><span class="op">)</span>, dc.min <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make clusters</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load objects into clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classes"</span>, <span class="st">"data"</span>, <span class="st">"full_dtm"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Model_Accuracies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># reload packages each time</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/miserman/lingmatch" class="external-link">lingmatch</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/majkamichal/naivebayes" class="external-link">naivebayes</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># draw a new set of training ids</span></span>
<span>  <span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">classes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">class_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Recall</span> <span class="op">==</span> <span class="va">class</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">class_ids</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">class_ids</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.7</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>, use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">train_dtm</span> <span class="op">&lt;-</span> <span class="va">full_dtm</span><span class="op">[</span><span class="va">ids</span>, <span class="op">]</span></span>
<span>  <span class="va">feminine_texts</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">ids</span>, <span class="st">"Recall"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Feminine"</span></span>
<span>  <span class="va">test_dtm</span> <span class="op">&lt;-</span> <span class="va">full_dtm</span><span class="op">[</span><span class="op">-</span><span class="va">ids</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="co"># train models</span></span>
<span>  <span class="va">terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">train_dtm</span><span class="op">[</span><span class="va">feminine_texts</span>, <span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">train_dtm</span><span class="op">[</span><span class="op">!</span><span class="va">feminine_texts</span>, <span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://majkamichal.github.io/naivebayes/reference/bernoulli_naive_bayes.html" class="external-link">bernoulli_naive_bayes</a></span><span class="op">(</span></span>
<span>    <span class="op">(</span><span class="va">train_dtm</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span>, <span class="va">data</span><span class="op">[</span><span class="va">ids</span>, <span class="st">"Recall"</span><span class="op">]</span>,</span>
<span>    laplace <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">dtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">ids</span>, <span class="st">"Recall"</span><span class="op">]</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_dtm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_dtm</span><span class="op">)</span>, <span class="va">data</span><span class="op">[</span><span class="va">ids</span>, <span class="st">"Recall"</span><span class="op">]</span>, <span class="st">"svmLinear3"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># test models</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    terms <span class="op">=</span> <span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html" class="external-link">max.col</a></span><span class="op">(</span><span class="fu"><a href="../reference/lma_termcat.html">lma_termcat</a></span><span class="op">(</span></span>
<span>      <span class="va">test_dtm</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">terms</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">terms</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    bayes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bayes</span>, <span class="op">(</span><span class="va">test_dtm</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    dtree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">dtree</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_dtm</span><span class="op">)</span><span class="op">)</span>, <span class="st">"class"</span><span class="op">)</span>,</span>
<span>    svm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">svm</span>, <span class="va">test_dtm</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">==</span> <span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">ids</span>, <span class="st">"Recall"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">Model_Accuracies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Average</span></span>
<span><span class="co">#&gt; terms 0.6810769</span></span>
<span><span class="co">#&gt; bayes 0.7193846</span></span>
<span><span class="co">#&gt; dtree 0.7223077</span></span>
<span><span class="co">#&gt; svm   0.7133846</span></span>
<span><span class="fu"><a href="https://miserman.github.io/splot/reference/splot.html" class="external-link">splot</a></span><span class="op">(</span><span class="va">Model_Accuracies</span>, title <span class="op">=</span> <span class="cn">FALSE</span>, leg.title <span class="op">=</span> <span class="st">"Model"</span>, dark <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="text_classification_files/figure-html/unnamed-chunk-14-1.svg" width="864"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
